let movies = [
    {
        "title": "American Hustle",
        "audience_score": 74,
        "critic_score": 85
    },
    {
        "title": "Gravity",
        "audience_score": 79,
        "critic_score": 87
    },
    {
        "title": "12 Years a Slave",
        "audience_score": 86,
        "critic_score": 88
    },
    {
        "title": "Her",
        "audience_score": 84,
        "critic_score": 91
    },
    {
        "title": "The Wolf of Wall Street",
        "audience_score": 75,
        "critic_score": 73
    },
    {
        "title": "Nebraska",
        "audience_score": 82,
        "critic_score": 86
    },
    {
        "title": "Philomena",
        "audience_score": 84,
        "critic_score": 85
    },
    {
        "title": "Captain Phillips",
        "audience_score": 85,
        "critic_score": 87
    },
    {
        "title": "Dallas Buyers Club",
        "audience_score": 86,
        "critic_score": 87
    },
    {
        "title": "Boyhood",
        "audience_score": 78,
        "critic_score": 86
    },
    {
        "title": "Selma",
        "audience_score": 79,
        "critic_score": 86
    },
    {
        "title": "Birdman or (The Unexpected Virtue of Ignorance)",
        "audience_score": 80,
        "critic_score": 87
    },
    {
        "title": "The Theory of Everything",
        "audience_score": 81,
        "critic_score": 79
    },
    {
        "title": "American Sniper",
        "audience_score": 75,
        "critic_score": 69
    },
    {
        "title": "The Grand Budapest Hotel",
        "audience_score": 85,
        "critic_score": 88
    },
    {
        "title": "The Imitation Game",
        "audience_score": 86,
        "critic_score": 86
    },
    {
        "title": "Whiplash",
        "audience_score": 91,
        "critic_score": 91
    },
    {
        "title": "Brooklyn",
        "audience_score": 83,
        "critic_score": 88
    },
    {
        "title": "Spotlight",
        "audience_score": 87,
        "critic_score": 89
    },
    {
        "title": "The Big Short",
        "audience_score": 85,
        "critic_score": 85
    },
    {
        "title": "Mad Max: Fury Road",
        "audience_score": 86,
        "critic_score": 91
    },
    {
        "title": "Room",
        "audience_score": 88,
        "critic_score": 88
    },
    {
        "title": "The Martian",
        "audience_score": 86,
        "critic_score": 86
    },
    {
        "title": "Bridge of Spies",
        "audience_score": 82,
        "critic_score": 84
    },
    {
        "title": "The Revenant",
        "audience_score": 82,
        "critic_score": 79
    },
    {
        "title": "Fences",
        "audience_score": 74,
        "critic_score": 83
    },
    {
        "title": "Moonlight",
        "audience_score": 75,
        "critic_score": 85
    },
    {
        "title": "La La Land",
        "audience_score": 82,
        "critic_score": 87
    },
    {
        "title": "Manchester by the Sea",
        "audience_score": 80,
        "critic_score": 89
    },
    {
        "title": "Hell or High Water",
        "audience_score": 85,
        "critic_score": 89
    },
    {
        "title": "Hidden Figures",
        "audience_score": 84,
        "critic_score": 84
    },
    {
        "title": "Arrival",
        "audience_score": 82,
        "critic_score": 88
    },
    {
        "title": "Lion",
        "audience_score": 85,
        "critic_score": 82
    },
    {
        "title": "Hacksaw Ridge",
        "audience_score": 87,
        "critic_score": 84
    },
    {
        "title": "The Post",
        "audience_score": 72,
        "critic_score": 79
    },
    {
        "title": "Call Me by Your Name",
        "audience_score": 83,
        "critic_score": 87
    },
    {
        "title": "Lady Bird",
        "audience_score": 78,
        "critic_score": 88
    },
    {
        "title": "Phantom Thread",
        "audience_score": 74,
        "critic_score": 84
    },
    {
        "title": "The Shape of Water",
        "audience_score": 72,
        "critic_score": 81
    },
    {
        "title": "Darkest Hour",
        "audience_score": 78,
        "critic_score": 79
    },
    {
        "title": "Dunkirk",
        "audience_score": 82,
        "critic_score": 87
    },
    {
        "title": "Three Billboards Outside Ebbing, Missouri",
        "audience_score": 83,
        "critic_score": 84
    },
    {
        "title": "Get Out",
        "audience_score": 81,
        "critic_score": 87
    },
    {
        "title": "Roma",
        "audience_score": 75,
        "critic_score": 87
    },
    {
        "title": "The Favourite",
        "audience_score": 74,
        "critic_score": 85
    },
    {
        "title": "Bohemian Rhapsody",
        "audience_score": 67,
        "critic_score": 55
    },
    {
        "title": "Green Book",
        "audience_score": 80,
        "critic_score": 73
    },
    {
        "title": "BlacKkKlansman",
        "audience_score": 78,
        "critic_score": 85
    },
    {
        "title": "A Star Is Born",
        "audience_score": 82,
        "critic_score": 87
    },
    {
        "title": "Vice",
        "audience_score": 64,
        "critic_score": 66
    },
    {
        "title": "Black Panther",
        "audience_score": 79,
        "critic_score": 88
    },
    {
        "title": "Little Women",
        "audience_score": 84,
        "critic_score": 85
    },
    {
        "title": "Once Upon a Time... in Hollywood",
        "audience_score": 74,
        "critic_score": 82
    },
    {
        "title": "Marriage Story",
        "audience_score": 83,
        "critic_score": 88
    },
    {
        "title": "The Irishman",
        "audience_score": 84,
        "critic_score": 88
    },
    {
        "title": "1917",
        "audience_score": 86,
        "critic_score": 86
    },
    {
        "title": "Ford v Ferrari",
        "audience_score": 90,
        "critic_score": 87
    },
    {
        "title": "Parasite",
        "audience_score": 89,
        "critic_score": 93
    },
    {
        "title": "Jojo Rabbit",
        "audience_score": 86,
        "critic_score": 79
    },
    {
        "title": "Joker",
        "audience_score": 88,
        "critic_score": 79
    },
    {
        "title": "Mank",
        "audience_score": 63,
        "critic_score": 73
    },
    {
        "title": "Judas and the Black Messiah",
        "audience_score": 84,
        "critic_score": 85
    },
    {
        "title": "Nomadland",
        "audience_score": 78,
        "critic_score": 83
    },
    {
        "title": "The Trial of the Chicago 7",
        "audience_score": 83,
        "critic_score": 82
    },
    {
        "title": "Minari",
        "audience_score": 84,
        "critic_score": 89
    },
    {
        "title": "The Father",
        "audience_score": 89,
        "critic_score": 92
    },
    {
        "title": "Sound of Metal",
        "audience_score": 85,
        "critic_score": 89
    },
    {
        "title": "Promising Young Woman",
        "audience_score": 80,
        "critic_score": 81
    },
    {
        "title": "Licorice Pizza",
        "audience_score": 66,
        "critic_score": 78
    },
    {
        "title": "The Power of the Dog",
        "audience_score": 71,
        "critic_score": 80
    },
    {
        "title": "Nightmare Alley",
        "audience_score": 69,
        "critic_score": 75
    },
    {
        "title": "King Richard",
        "audience_score": 82,
        "critic_score": 78
    },
    {
        "title": "Drive My Car",
        "audience_score": 76,
        "critic_score": 86
    },
    {
        "title": "Belfast",
        "audience_score": 80,
        "critic_score": 77
    },
    {
        "title": "CODA",
        "audience_score": 83,
        "critic_score": 85
    },
    {
        "title": "West Side Story",
        "audience_score": 82,
        "critic_score": 82
    },
    {
        "title": "Dune",
        "audience_score": 85,
        "critic_score": 81
    },
    {
        "title": "Don't Look Up",
        "audience_score": 72,
        "critic_score": 61
    },
    {
        "title": "T\u00e1r",
        "audience_score": 74,
        "critic_score": 83
    },
    {
        "title": "The Banshees of Inisherin",
        "audience_score": 75,
        "critic_score": 86
    },
    {
        "title": "Women Talking",
        "audience_score": 71,
        "critic_score": 76
    },
    {
        "title": "The Fabelmans",
        "audience_score": 79,
        "critic_score": 83
    },
    {
        "title": "Elvis",
        "audience_score": 78,
        "critic_score": 70
    },
    {
        "title": "Everything Everywhere All at Once",
        "audience_score": 81,
        "critic_score": 85
    },
    {
        "title": "Top Gun: Maverick",
        "audience_score": 87,
        "critic_score": 85
    },
    {
        "title": "All Quiet on the Western Front",
        "audience_score": 85,
        "critic_score": 85
    },
    {
        "title": "Avatar: The Way of Water",
        "audience_score": 82,
        "critic_score": 74
    },
    {
        "title": "Triangle of Sadness",
        "audience_score": 76,
        "critic_score": 72
    },
    {
        "title": "Maestro",
        "audience_score": 57,
        "critic_score": 68
    },
    {
        "title": "Poor Things",
        "audience_score": 76,
        "critic_score": 82
    },
    {
        "title": "Oppenheimer",
        "audience_score": 88,
        "critic_score": 89
    },
    {
        "title": "Killers of the Flower Moon",
        "audience_score": 81,
        "critic_score": 85
    },
    {
        "title": "Past Lives",
        "audience_score": 82,
        "critic_score": 88
    },
    {
        "title": "The Zone of Interest",
        "audience_score": 76,
        "critic_score": 84
    },
    {
        "title": "Barbie",
        "audience_score": 72,
        "critic_score": 74
    },
    {
        "title": "American Fiction",
        "audience_score": 85,
        "critic_score": 83
    },
    {
        "title": "The Holdovers",
        "audience_score": 86,
        "critic_score": 89
    },
    {
        "title": "Anatomy of a Fall",
        "audience_score": 84,
        "critic_score": 87
    }
];
// Variable to determine whether to use audience score or critic score
let audience_score_enabled = false;


// Variable to track the user's score
let score = 0;

// Variable to track whether a choice has been made
let choiceMade = false;

// Function to select two random movies
function getRandomMovies() {
    const randomIndexes = [];
    while (randomIndexes.length < 2) {
        const randomIndex = Math.floor(Math.random() * movies.length);
        if (!randomIndexes.includes(randomIndex)) {
            randomIndexes.push(randomIndex);
        }
    }
    return [movies[randomIndexes[0]], movies[randomIndexes[1]]];
}

// Function to display movie titles and posters on the page
async function displayMovieTitles() {
    const movieContainer = document.getElementById('movieTitles');
    const randomMovies = getRandomMovies();
    movieContainer.innerHTML = '';
    
    for (const movie of randomMovies) {
        const score = audience_score_enabled ? movie.audience_score : movie.critic_score;

        const posterUrl = await fetchMoviePoster(movie.title);
        
        // Create elements to display movie title and poster
        const movieDiv = document.createElement('div');
        const movieTitleElement = document.createElement('p');
        const moviePosterElement = document.createElement('img');

        movieDiv.classList.add('movie-item');
        
        // Set movie title and poster URL
        movieTitleElement.textContent = movie.title;
        moviePosterElement.src = posterUrl;
        
        // Append elements to movie container
        movieDiv.appendChild(movieTitleElement);
        movieDiv.appendChild(moviePosterElement);
        movieContainer.appendChild(movieDiv);
        
        // Add event listeners to movie title and poster
        movieTitleElement.addEventListener('click', function() {
            checkUserChoice(movie, randomMovies);
        });
        moviePosterElement.addEventListener('click', function() {
            checkUserChoice(movie, randomMovies);
        });
    }
}

// Function to fetch movie poster using TMDB API
async function fetchMoviePoster(movieTitle) {
    const apiKey = '352d50e929f67aea3a7aca5c902400dd'; // Replace 'YOUR_API_KEY' with your actual API key from TMDB
    const apiUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(movieTitle)}`;
    
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        // Check if any movies were found
        if (data.results.length > 0) {
            // Assuming the first result is the most relevant one
            const movie = data.results[0];
            const posterPath = movie.poster_path;
            
            if (posterPath) {
                // Construct the full URL for the poster
                return `https://image.tmdb.org/t/p/w500/${posterPath}`;
            } else {
                return 'Poster not available';
            }
        } else {
            return 'Movie not found';
        }
    } catch (error) {
        console.error('Error fetching movie poster:', error);
        return null;
    }
}

// Function to check if the user's choice is correct
async function checkUserChoice(selectedMovie, randomMovies) {
    // If a choice has already been made, return without doing anything
    if (choiceMade) {
        return;
    }
    const resultElement = document.getElementById('result');
    const otherMovie = randomMovies.find(movie => movie !== selectedMovie);
    const selectedScore = audience_score_enabled ? selectedMovie.audience_score : selectedMovie.critic_score;
    const otherScore = audience_score_enabled ? otherMovie.audience_score : otherMovie.critic_score;
    if (selectedScore > otherScore) {
        resultElement.textContent = "Correct! " + selectedMovie.title + " has a higher score.";
        // Increment score and update score display
        score++;
        document.getElementById('score').textContent = score;
        // Display next set of movie titles
        await displayMovieTitles();
    } else if (selectedScore < otherScore) {
        resultElement.textContent = "Wrong! " + otherMovie.title + " has a higher score.";
        // Reset score to 0 and update score display
        score = 0;
        document.getElementById('score').textContent = score;
        // Show the "Try Again" button
        document.getElementById('tryAgainBtn').style.display = 'block';
    } else {
        resultElement.textContent = "It's a tie!";
        // Display next set of movie titles
        await displayMovieTitles();
    }
    // Reset choiceMade to false
    choiceMade = false;
}

// Function to handle "Try Again" button click
function tryAgain() {
    // Hide the "Try Again" button
    document.getElementById('tryAgainBtn').style.display = 'none';
    // Clear the result text
    document.getElementById('result').textContent = '';
    // Re-display movie titles
    displayMovieTitles();
}

// Function to handle "Next Lot" button click
function nextLot() {
    // Clear the result text
    document.getElementById('result').textContent = '';
    // Re-display movie titles
    displayMovieTitles();
}

// Call the function to display movie titles when the page loads
window.onload = displayMovieTitles;

// Attach event listener to the "Try Again" button
document.getElementById('tryAgainBtn').addEventListener('click', tryAgain);

// Add event listener to the checkbox
document.getElementById('audienceScoreToggle').addEventListener('change', function(event) {
    audience_score_enabled = event.target.checked;
    // Clear the result text and re-display movie titles when the audience score preference changes
    document.getElementById('result').textContent = '';
    displayMovieTitles();
});

async function preloadMoviePosters() {
    for (const movie of movies) {
        const posterUrl = await fetchMoviePoster(movie.title);
        movie.posterUrl = posterUrl;
    }
}

// Show content after preloading is complete
preloadMoviePosters().then(() => {
    // Hide loading overlay and show content
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('content').style.display = 'block';
    // Call displayMovieTitles to display movie titles with preloaded posters
    displayMovieTitles();
});